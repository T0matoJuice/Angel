# ä¿®å¤é¢„è§ˆé¡µé¢"æ–‡ä»¶ä¸å­˜åœ¨"é—®é¢˜

## é—®é¢˜æè¿°

æ£€æµ‹å®Œæˆåï¼Œç»“æœé¡µé¢æ˜¾ç¤º"æ–‡ä»¶ä¸å­˜åœ¨"ï¼š
- âœ… Excelç»“æœæ–‡ä»¶å·²æˆåŠŸç”Ÿæˆ
- âŒ å‰ç«¯æ˜¾ç¤º"âŒ æ–‡ä»¶ä¸å­˜åœ¨"
- âŒ æ—¥å¿—æ˜¾ç¤ºï¼š`GET /excel/get-result-data/null HTTP/1.1" 404`

## é—®é¢˜åŸå› 

**é˜Ÿåˆ—ç®¡ç†å™¨åªç”Ÿæˆäº†Excelæ–‡ä»¶ï¼Œæ²¡æœ‰ç”ŸæˆCSVæ–‡ä»¶ï¼**

### é˜Ÿåˆ—ç®¡ç†å™¨ç”Ÿæˆçš„æ–‡ä»¶
```python
# modules/excel/queue_manager.py (ä¿®å¤å‰)
self.task_results[filename] = {
    'excel_filename': result_filename,
    'csv_filename': None,  # âŒ æ²¡æœ‰CSVæ–‡ä»¶
    ...
}
```

### å‰ç«¯æœŸæœ›çš„æ–‡ä»¶
```javascript
// templates/excel_quality_result.html (ç¬¬549è¡Œ)
loadResultTable(data.csv_filename);  // âŒ csv_filenameæ˜¯null

// ç¬¬563è¡Œ
fetch(`/excel/get-result-data/${csvFilename}`)  // âŒ è¯·æ±‚ /excel/get-result-data/null
```

### åç«¯æ¥å£
```python
# modules/excel/routes.py (ç¬¬454è¡Œ)
df = pd.read_csv(filepath, dtype=str)  # âŒ åªæ”¯æŒCSVæ–‡ä»¶
```

**ç»“æœ**ï¼š
- `csv_filename` æ˜¯ `None`
- å‰ç«¯è¯·æ±‚ `/excel/get-result-data/null`
- åç«¯è¿”å›404é”™è¯¯

## è§£å†³æ–¹æ¡ˆ

ä¿®æ”¹é˜Ÿåˆ—ç®¡ç†å™¨ï¼Œ**åŒæ—¶ç”ŸæˆCSVå’ŒExcelæ–‡ä»¶**ã€‚

### ä¿®æ”¹å†…å®¹

**æ–‡ä»¶**ï¼š`modules/excel/queue_manager.py` (ç¬¬453-480è¡Œ)

**ä¿®æ”¹å‰**ï¼š
```python
# ç”Ÿæˆç»“æœæ–‡ä»¶å
if filename.lower().endswith('.xlsx'):
    result_filename = f"quality_result_{filename}"
else:
    result_filename = f"quality_result_{filename}.xlsx"

# ä¿å­˜Excelæ–‡ä»¶
result_filepath = os.path.join(results_folder, result_filename)
df_result.to_excel(result_filepath, index=False)
print(f"âœ… Excelç»“æœæ–‡ä»¶å·²ç”Ÿæˆ: {result_filename}")

# ä¿å­˜åˆ°task_results
self.task_results[filename] = {
    'excel_filename': result_filename,
    'csv_filename': None,  # âŒ æ²¡æœ‰CSV
    ...
}
```

**ä¿®æ”¹å**ï¼š
```python
# ç”Ÿæˆç»“æœæ–‡ä»¶å
if filename.lower().endswith('.xlsx'):
    base_filename = filename[:-5]  # å»æ‰.xlsx
    excel_filename = f"quality_result_{filename}"
    csv_filename = f"quality_result_{base_filename}.csv"
else:
    excel_filename = f"quality_result_{filename}.xlsx"
    csv_filename = f"quality_result_{filename}.csv"

# ä¿å­˜Excelæ–‡ä»¶
excel_filepath = os.path.join(results_folder, excel_filename)
df_result.to_excel(excel_filepath, index=False)
print(f"âœ… Excelç»“æœæ–‡ä»¶å·²ç”Ÿæˆ: {excel_filename}")

# ä¿å­˜CSVæ–‡ä»¶ï¼ˆç”¨äºå‰ç«¯é¢„è§ˆï¼‰
csv_filepath = os.path.join(results_folder, csv_filename)
df_result.to_csv(csv_filepath, index=False, encoding='utf-8')
print(f"âœ… CSVç»“æœæ–‡ä»¶å·²ç”Ÿæˆ: {csv_filename}")

# ä¿å­˜åˆ°task_results
self.task_results[filename] = {
    'excel_filename': excel_filename,
    'csv_filename': csv_filename,  # âœ… æœ‰CSVæ–‡ä»¶
    ...
}
```

## æ–‡ä»¶å‘½åè§„åˆ™

### ç½‘é¡µä¸Šä¼ ï¼ˆfilenameæœ‰æ‰©å±•åï¼‰
- è¾“å…¥ï¼š`20251219_113741_å·¥ä½œç°¿1.xlsx`
- Excelï¼š`quality_result_20251219_113741_å·¥ä½œç°¿1.xlsx`
- CSVï¼š`quality_result_20251219_113741_å·¥ä½œç°¿1.csv`

### APIä¸Šä¼ ï¼ˆfilenameæ— æ‰©å±•åï¼‰
- è¾“å…¥ï¼š`batch_001_20251219_113038_229824_4487`
- Excelï¼š`quality_result_batch_001_20251219_113038_229824_4487.xlsx`
- CSVï¼š`quality_result_batch_001_20251219_113038_229824_4487.csv`

## æµ‹è¯•æ­¥éª¤

1. **é‡å¯Flaskåº”ç”¨**
   ```bash
   # åœæ­¢åº”ç”¨ï¼ˆCtrl+Cï¼‰
   python app.py
   ```

2. **ä¸Šä¼ æµ‹è¯•æ•°æ®**
   - é€šè¿‡ç½‘é¡µæˆ–APIä¸Šä¼ Excelæ–‡ä»¶
   - ç­‰å¾…æ£€æµ‹å®Œæˆ

3. **éªŒè¯ç»“æœ**
   - æ£€æµ‹å®Œæˆåä¼šè‡ªåŠ¨è·³è½¬åˆ°ç»“æœé¡µé¢
   - åº”è¯¥èƒ½çœ‹åˆ°æ£€æµ‹ç»“æœè¡¨æ ¼
   - ä¸å†æ˜¾ç¤º"æ–‡ä»¶ä¸å­˜åœ¨"é”™è¯¯

4. **æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶**
   ```bash
   # æŸ¥çœ‹resultsç›®å½•
   ls results/quality_result_*
   ```
   åº”è¯¥åŒæ—¶æœ‰ `.xlsx` å’Œ `.csv` æ–‡ä»¶

## é¢„æœŸç»“æœ

### æ£€æµ‹å®Œæˆå
- âœ… ç”ŸæˆExcelæ–‡ä»¶ï¼ˆç”¨äºä¸‹è½½ï¼‰
- âœ… ç”ŸæˆCSVæ–‡ä»¶ï¼ˆç”¨äºå‰ç«¯é¢„è§ˆï¼‰
- âœ… ç»“æœé¡µé¢æ­£å¸¸æ˜¾ç¤ºæ£€æµ‹ç»“æœè¡¨æ ¼
- âœ… å¯ä»¥ä¸‹è½½Excelå’ŒCSVæ–‡ä»¶

### æ—¥å¿—è¾“å‡º
```
âœ… Excelç»“æœæ–‡ä»¶å·²ç”Ÿæˆ: quality_result_xxx.xlsx
âœ… CSVç»“æœæ–‡ä»¶å·²ç”Ÿæˆ: quality_result_xxx.csv
```

## ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç§æ ¼å¼ï¼Ÿ

1. **Excelæ–‡ä»¶**ï¼š
   - ç”¨äºä¸‹è½½
   - æ ¼å¼æ›´å¥½ï¼Œæ”¯æŒæ ·å¼
   - ç”¨æˆ·å‹å¥½

2. **CSVæ–‡ä»¶**ï¼š
   - ç”¨äºå‰ç«¯é¢„è§ˆ
   - æ–‡ä»¶æ›´å°ï¼ŒåŠ è½½æ›´å¿«
   - æ˜“äºè§£æå’Œæ˜¾ç¤º

## æ€»ç»“

é—®é¢˜å·²ä¿®å¤ï¼ç°åœ¨ï¼š
- âœ… é˜Ÿåˆ—ç®¡ç†å™¨åŒæ—¶ç”ŸæˆExcelå’ŒCSVæ–‡ä»¶
- âœ… å‰ç«¯å¯ä»¥æ­£å¸¸é¢„è§ˆæ£€æµ‹ç»“æœ
- âœ… ç”¨æˆ·å¯ä»¥ä¸‹è½½Excelæ–‡ä»¶
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

é¢„è§ˆåŠŸèƒ½å®Œå…¨æ­£å¸¸äº†ï¼ğŸ‰
