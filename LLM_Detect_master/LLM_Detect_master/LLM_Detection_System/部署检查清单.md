# 质量工单检测系统 - 部署检查清单

## ✅ 部署前检查

### 1. 环境检查

#### 1.1 Python环境
- [ ] Python版本：3.8+ ✅
- [ ] Anaconda已安装 ✅
- [ ] 当前Python路径：`C:\ProgramData\anaconda3\python.exe` 或 `python`

#### 1.2 MySQL数据库
- [ ] MySQL服务正在运行 ✅
- [ ] 数据库名称：`angel` ✅
- [ ] 连接信息：`root/123456@localhost:3306` ✅
- [ ] 字符集：`utf8mb4` ✅

#### 1.3 Python依赖包
```bash
# 检查必要的包
pip list | grep -E "Flask|pandas|pymysql|openpyxl|SQLAlchemy"
```

必需的包：
- [ ] Flask
- [ ] Flask-Login
- [ ] Flask-SQLAlchemy
- [ ] pandas
- [ ] pymysql
- [ ] openpyxl
- [ ] openai（或其他AI SDK）

---

### 2. 文件检查

#### 2.1 新增文件（9个）
- [ ] `LLM_Detection_System/sql/create_workorder_tables.sql` ✅
- [ ] `LLM_Detection_System/init_workorder_tables.py` ✅
- [ ] `LLM_Detection_System/modules/excel/models.py` ✅
- [ ] `LLM_Detection_System/modules/excel/field_mapping.py` ✅
- [ ] `LLM_Detection_System/test_workorder_system.py` ✅
- [ ] `LLM_Detection_System/质量工单检测系统升级说明.md` ✅
- [ ] `LLM_Detection_System/83字段Excel格式说明.md` ✅
- [ ] `LLM_Detection_System/快速开始指南.md` ✅
- [ ] `LLM_Detection_System/升级完成总结.md` ✅

#### 2.2 修改文件（1个）
- [ ] `LLM_Detection_System/modules/excel/routes.py` ✅

#### 2.3 训练数据文件
- [ ] `data/训练数据新100条.xlsx` ✅

---

### 3. 数据库初始化

#### 3.1 运行初始化脚本
```bash
cd C:/Users/root/Desktop/LLM_Detect_master
python LLM_Detection_System/init_workorder_tables.py
```

**预期输出**：
```
✅ workorder_data表创建成功
✅ workorder_uselessdata_1表创建成功
✅ workorder_uselessdata_2表创建成功
✅ 所有表创建成功！
```

#### 3.2 验证表结构
```sql
-- 连接MySQL
mysql -u root -p

-- 使用angel数据库
USE angel;

-- 查看表
SHOW TABLES;

-- 应该看到以下3张表：
-- workorder_data
-- workorder_uselessdata_1
-- workorder_uselessdata_2

-- 查看表结构
DESC workorder_data;
DESC workorder_uselessdata_1;
DESC workorder_uselessdata_2;
```

检查点：
- [ ] workorder_data表存在，包含20个字段 ✅
- [ ] workorder_uselessdata_1表存在，包含42个字段 ✅
- [ ] workorder_uselessdata_2表存在，包含31个字段 ✅
- [ ] 索引已创建（filename, workAlone, account） ✅

---

### 4. 系统测试

#### 4.1 运行测试脚本
```bash
python LLM_Detection_System/test_workorder_system.py
```

**预期结果**：
```
测试1：数据库连接          ✅ 通过
测试2：表结构验证          ✅ 通过
测试3：字段映射验证        ✅ 通过
测试4：数据模型导入        ⚠️ 需要Flask上下文（正常）
测试5：数据查询            ✅ 通过
```

检查点：
- [ ] 数据库连接成功 ✅
- [ ] 表结构验证通过 ✅
- [ ] 字段映射验证通过 ✅
- [ ] 数据查询成功 ✅

---

### 5. 应用启动

#### 5.1 启动Flask应用
```bash
python LLM_Detection_System/app.py
```

**预期输出**：
```
==== 大模型智能检测系统 ====
访问地址: http://localhost:5000
提示：首次运行会自动创建数据库
 * Running on http://0.0.0.0:5000
```

检查点：
- [ ] 应用启动成功 ✅
- [ ] 无错误信息 ✅
- [ ] 端口5000可访问 ✅

#### 5.2 访问系统
打开浏览器，访问：`http://localhost:5000`

检查点：
- [ ] 首页加载成功 ✅
- [ ] 登录功能正常 ✅
- [ ] 导航栏显示正常 ✅

---

### 6. 功能测试

#### 6.1 准备测试数据
创建一个测试Excel文件，包含以下列：

| 工单单号 | 判定依据 | 故障部位名称 | 故障组 | 故障类别 | 服务项目或故障现象 | 故障件简称 | 来电内容 | 现场诊断故障现象 | 处理方案简述或备注 |
|---------|---------|-------------|--------|---------|------------------|-----------|---------|----------------|------------------|
| TEST001 | 测试数据 | 测试部位 | 测试组 | 测试类别 | 测试现象 | 测试件 | 测试内容 | 测试诊断 | 测试方案 |

#### 6.2 上传测试
1. 登录系统
2. 进入"Excel工单检测" → "质量工单检测"
3. 上传测试Excel文件
4. 点击"开始质量工单判断"

检查点：
- [ ] 文件上传成功 ✅
- [ ] 数据入库成功 ✅
- [ ] AI判断执行成功 ✅
- [ ] 结果回写成功 ✅
- [ ] 结果文件生成成功 ✅

#### 6.3 数据验证
```sql
-- 查询测试数据
SELECT * FROM workorder_data WHERE workAlone = 'TEST001';

-- 验证字段
-- account: 当前登录用户
-- datatime: 上传时间
-- filename: 带时间戳的文件名
-- workAlone: TEST001
-- workOrderNature: AI判断结果（质量工单/非质量工单）
```

检查点：
- [ ] 数据已写入workorder_data表 ✅
- [ ] 数据已写入workorder_uselessdata_1表 ✅
- [ ] 数据已写入workorder_uselessdata_2表 ✅
- [ ] workOrderNature字段已更新 ✅

#### 6.4 结果下载
1. 下载结果Excel文件
2. 打开文件验证

检查点：
- [ ] 文件包含11个字段 ✅
- [ ] "工单性质"列有值 ✅
- [ ] 数据完整无误 ✅

---

### 7. 性能测试

#### 7.1 小数据量测试（10行）
- [ ] 上传成功 ✅
- [ ] 处理时间 < 30秒 ✅
- [ ] 结果正确 ✅

#### 7.2 中等数据量测试（100行）
- [ ] 上传成功 ✅
- [ ] 处理时间 < 2分钟 ✅
- [ ] 结果正确 ✅

#### 7.3 大数据量测试（1000行）
- [ ] 上传成功 ✅
- [ ] 处理时间 < 10分钟 ✅
- [ ] 结果正确 ✅

---

### 8. 错误处理测试

#### 8.1 无效文件测试
- [ ] 上传.xls文件 → 提示格式错误 ✅
- [ ] 上传.csv文件 → 提示格式错误 ✅
- [ ] 上传空文件 → 提示文件为空 ✅

#### 8.2 缺失字段测试
- [ ] 缺少"工单单号"列 → 提示必填字段缺失 ✅
- [ ] 工单单号为空 → 跳过该行 ✅

#### 8.3 数据库错误测试
- [ ] 停止MySQL服务 → 提示数据库连接失败 ✅
- [ ] 恢复MySQL服务 → 系统恢复正常 ✅

---

### 9. 安全性检查

#### 9.1 用户隔离
- [ ] 用户A只能看到自己的数据 ✅
- [ ] 用户B只能看到自己的数据 ✅
- [ ] 数据不会混淆 ✅

#### 9.2 文件名唯一性
- [ ] 同一文件多次上传，文件名不同 ✅
- [ ] 文件名包含时间戳 ✅
- [ ] 不会覆盖历史数据 ✅

---

### 10. 文档检查

#### 10.1 用户文档
- [ ] 《快速开始指南.md》完整 ✅
- [ ] 《83字段Excel格式说明.md》完整 ✅
- [ ] 《质量工单检测系统升级说明.md》完整 ✅

#### 10.2 技术文档
- [ ] 《升级完成总结.md》完整 ✅
- [ ] 代码注释完整 ✅
- [ ] SQL脚本有注释 ✅

---

## 🎯 部署完成标准

### 必须通过的检查项（关键）
- ✅ 数据库表创建成功
- ✅ 测试脚本通过（4/5项）
- ✅ 应用启动成功
- ✅ 文件上传成功
- ✅ AI判断成功
- ✅ 结果回写成功
- ✅ 数据查询成功

### 建议通过的检查项（重要）
- ✅ 性能测试通过
- ✅ 错误处理正常
- ✅ 用户隔离有效
- ✅ 文档完整

---

## 📝 部署记录

### 部署信息
- **部署日期**：_____________
- **部署人员**：_____________
- **系统版本**：83字段完整版
- **数据库版本**：MySQL _____

### 检查结果
- **必须检查项通过**：_____ / 7
- **建议检查项通过**：_____ / 4
- **总体通过率**：_____ %

### 部署状态
- [ ] ✅ 通过，可以投入使用
- [ ] ⚠️ 部分通过，需要修复问题
- [ ] ❌ 未通过，需要重新部署

### 备注
```
_____________________________________________
_____________________________________________
_____________________________________________
```

---

## 🚨 常见问题排查

### 问题1：数据库连接失败
**症状**：提示"数据库连接失败"
**排查**：
1. 检查MySQL服务是否运行
2. 检查数据库名称是否为"angel"
3. 检查用户名密码是否正确（root/123456）
4. 检查端口是否为3306

### 问题2：表创建失败
**症状**：初始化脚本报错
**排查**：
1. 检查数据库是否存在
2. 检查用户是否有CREATE权限
3. 检查表是否已存在（删除后重建）

### 问题3：AI判断失败
**症状**：处理过程中报错
**排查**：
1. 检查训练数据文件是否存在（data/训练数据新100条.xlsx）
2. 检查AI API配置是否正确
3. 检查网络连接是否正常

### 问题4：结果回写失败
**症状**：数据库中workOrderNature字段为空
**排查**：
1. 检查AI判断是否成功
2. 检查CSV解析是否正确
3. 检查工单单号是否匹配

---

## 📞 技术支持

### 获取帮助
1. 查看《快速开始指南.md》
2. 查看《质量工单检测系统升级说明.md》
3. 运行测试脚本：`python test_workorder_system.py`
4. 查看应用日志

### 联系方式
- 技术文档：LLM_Detection_System/文档目录
- 测试脚本：LLM_Detection_System/test_workorder_system.py
- 数据库脚本：LLM_Detection_System/sql/

---

**检查清单版本**：1.0
**最后更新**：2025年1月

