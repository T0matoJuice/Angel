# 快速开始指南

## 人工判断工单性质数据同步工具

### 📋 前提条件

- ✅ 已安装Python 3.x
- ✅ 已配置数据库连接（`.env` 文件）
- ✅ 可以连接内部VPN（生产环境）

### 🚀 快速开始（3步完成）

#### 第1步：添加数据库字段（仅首次）

```bash
cd d:\work\angel\Angel\LLM_Detect_master\LLM_Detect_master\LLM_Detection_System
python modules\excel\add_workorder_nature_correct_field.py
```

**预期输出**：
```
============================================================
数据库迁移：添加 workOrderNature_correct 字段
============================================================

正在执行SQL...
...
✓ 字段添加成功！
```

#### 第2步：测试功能（可选，无需VPN）

```bash
python modules\excel\test_sync_manual_judgment.py
```

**预期输出**：
```
============================================================
检查数据库字段
============================================================

✓ 字段已存在
  字段名: workOrderNature_correct
  类型: varchar(255)
  ...

============================================================
测试：人工判断数据同步逻辑
============================================================
...
```

#### 第3步：执行同步（需要VPN）

```bash
# 连接VPN后执行
python modules\excel\sync_manual_judgment.py --start-date 2025-01-01 --end-date 2025-01-01
```

**预期输出**：
```
============================================================
人工判断工单性质数据同步工具
============================================================
正在获取Bearer Token...
✓ Token获取成功: Bearer eyJhbGci...

正在获取人工判断数据 (2025-01-01 ~ 2025-01-01)...
✓ 成功获取 150 条人工判断数据

正在更新数据库...
✓ 数据库更新完成

============================================================
同步完成统计
============================================================
总记录数:     150
成功更新:     145
未找到工单:   5
更新失败:     0
============================================================
```

### 📁 文件说明

| 文件名 | 用途 | 何时使用 |
|--------|------|---------|
| `add_workorder_nature_correct_field.py` | 数据库迁移 | 首次使用前执行一次 |
| `sync_manual_judgment.py` | 主同步脚本 | 每次需要同步数据时 |
| `test_sync_manual_judgment.py` | 测试脚本 | 验证功能是否正常 |
| `README_sync_manual_judgment.md` | 详细文档 | 查看完整说明 |

### ⚠️ 注意事项

1. **VPN连接**：生产环境必须连接内部VPN
2. **日期格式**：必须使用 `YYYY-MM-DD` 格式
3. **首次使用**：必须先执行第1步添加数据库字段
4. **重复执行**：可以安全地重复执行，会覆盖已有数据

### 🔧 常见问题

**Q: 提示"Connection refused"怎么办？**  
A: 请确保已连接内部VPN

**Q: 提示"Duplicate column name"怎么办？**  
A: 字段已存在，无需重复执行第1步

**Q: 提示"未找到工单"是错误吗？**  
A: 不是错误，说明API返回的工单在本地数据库中不存在，这是正常情况

**Q: 如何同步多天的数据？**  
A: 修改日期范围即可，例如：
```bash
python modules\excel\sync_manual_judgment.py --start-date 2025-01-01 --end-date 2025-01-31
```

### 📞 技术支持

如有问题，请查看详细文档：`README_sync_manual_judgment.md`
