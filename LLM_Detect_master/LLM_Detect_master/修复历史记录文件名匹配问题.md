# ä¿®å¤å†å²è®°å½•APIæ–‡ä»¶ååŒ¹é…é—®é¢˜

## é—®é¢˜æè¿°

Excelç»“æœæ–‡ä»¶å·²ç»æˆåŠŸç”Ÿæˆï¼š
```
âœ… Excelç»“æœæ–‡ä»¶å·²ç”Ÿæˆ: quality_result_batch_001_20251219_113038_229824_4487.xlsx
```

ä½†æ˜¯å†å²è®°å½•é¡µé¢æ˜¾ç¤º"æ— ç»“æœ"ï¼Œä¸‹è½½æŒ‰é’®æ˜¯ç°è‰²çš„ã€‚

## é—®é¢˜åŸå› 

**æ–‡ä»¶åä¸åŒ¹é…ï¼**

### é˜Ÿåˆ—ç®¡ç†å™¨ç”Ÿæˆçš„æ–‡ä»¶å
```python
# modules/excel/queue_manager.py (ç¬¬456-461è¡Œ)
if filename.lower().endswith('.xlsx'):
    result_filename = f"quality_result_{filename}"
else:
    result_filename = f"quality_result_{filename}.xlsx"

# å¯¹äº filename = "batch_001_20251219_113038_229824_4487"
# ç”Ÿæˆï¼šquality_result_batch_001_20251219_113038_229824_4487.xlsx âœ…
```

### å†å²è®°å½•APIæ£€æŸ¥çš„æ–‡ä»¶å
```python
# modules/excel/routes.py (ç¬¬554è¡Œï¼Œä¿®å¤å‰)
result_filename = f"quality_result_{filename}"

# å¯¹äº filename = "batch_001_20251219_113038_229824_4487"
# æ£€æŸ¥ï¼šquality_result_batch_001_20251219_113038_229824_4487 âŒ (æ²¡æœ‰æ‰©å±•å)
```

**ç»“æœ**ï¼š`os.path.exists()` è¿”å› `False`ï¼Œæ‰€ä»¥ `has_result_file = False`ã€‚

## è§£å†³æ–¹æ¡ˆ

ä¿®æ”¹äº†ä¸¤ä¸ªåœ°æ–¹çš„æ–‡ä»¶åç”Ÿæˆé€»è¾‘ï¼Œä½¿å…¶ä¸é˜Ÿåˆ—ç®¡ç†å™¨ä¸€è‡´ï¼š

### 1. å†å²è®°å½•åˆ—è¡¨API (`modules/excel/routes.py` ç¬¬552-561è¡Œ)

**ä¿®æ”¹å‰**ï¼š
```python
result_filename = f"quality_result_{filename}"
result_filepath = os.path.join(current_app.config['RESULTS_FOLDER'], result_filename)
has_result_file = os.path.exists(result_filepath)
```

**ä¿®æ”¹å**ï¼š
```python
# ç¡®ä¿æ–‡ä»¶åä»¥.xlsxç»“å°¾ï¼ˆä¸é˜Ÿåˆ—ç®¡ç†å™¨ç”Ÿæˆçš„æ–‡ä»¶åä¸€è‡´ï¼‰
if filename.lower().endswith('.xlsx'):
    result_filename = f"quality_result_{filename}"
else:
    result_filename = f"quality_result_{filename}.xlsx"

result_filepath = os.path.join(current_app.config['RESULTS_FOLDER'], result_filename)
has_result_file = os.path.exists(result_filepath)
```

### 2. å†å²è®°å½•è¯¦æƒ…API (`modules/excel/routes.py` ç¬¬632-640è¡Œ)

**ä¿®æ”¹å‰**ï¼š
```python
result_filename = f"quality_result_{filename}"
result_filepath = os.path.join(current_app.config['RESULTS_FOLDER'], result_filename)
has_result_file = os.path.exists(result_filepath)
```

**ä¿®æ”¹å**ï¼š
```python
# ç¡®ä¿æ–‡ä»¶åä»¥.xlsxç»“å°¾ï¼ˆä¸é˜Ÿåˆ—ç®¡ç†å™¨ç”Ÿæˆçš„æ–‡ä»¶åä¸€è‡´ï¼‰
if filename.lower().endswith('.xlsx'):
    result_filename = f"quality_result_{filename}"
else:
    result_filename = f"quality_result_{filename}.xlsx"

result_filepath = os.path.join(current_app.config['RESULTS_FOLDER'], result_filename)
has_result_file = os.path.exists(result_filepath)
```

## æµ‹è¯•æ­¥éª¤

1. **é‡å¯Flaskåº”ç”¨**
   ```bash
   # åœæ­¢åº”ç”¨ï¼ˆCtrl+Cï¼‰
   python app.py
   ```

2. **åˆ·æ–°å†å²è®°å½•é¡µé¢**
   - æŒ‰ `Ctrl+Shift+R` å¼ºåˆ¶åˆ·æ–°
   - æˆ–è€…ç›´æ¥è®¿é—® `/drawing/history`

3. **éªŒè¯ç»“æœ**
   - æ‰¾åˆ°åˆšæ‰ä¸Šä¼ çš„è®°å½•ï¼ˆ`batch_001_20251219_113038_229824_4487`ï¼‰
   - ä¸‹è½½æŒ‰é’®åº”è¯¥æ˜¯**è“è‰²å¯ç”¨**çŠ¶æ€
   - ç‚¹å‡»ä¸‹è½½ï¼Œåº”è¯¥èƒ½æˆåŠŸä¸‹è½½Excelæ–‡ä»¶

## é¢„æœŸç»“æœ

### ç½‘é¡µä¸Šä¼ ï¼ˆfilenameæœ‰æ‰©å±•åï¼‰
- æ–‡ä»¶åï¼š`20251218_194158_å·¥ä½œç°¿1.xlsx`
- ç»“æœæ–‡ä»¶ï¼š`quality_result_20251218_194158_å·¥ä½œç°¿1.xlsx`
- âœ… åŒ¹é…æˆåŠŸ

### APIä¸Šä¼ ï¼ˆfilenameæ— æ‰©å±•åï¼‰
- æ–‡ä»¶åï¼š`batch_001_20251219_113038_229824_4487`
- ç»“æœæ–‡ä»¶ï¼š`quality_result_batch_001_20251219_113038_229824_4487.xlsx`
- âœ… åŒ¹é…æˆåŠŸ

## ä¿®æ”¹çš„æ–‡ä»¶

1. `modules/excel/queue_manager.py` - ç”ŸæˆExcelæ–‡ä»¶æ—¶æ·»åŠ æ‰©å±•å
2. `modules/excel/routes.py` - å†å²è®°å½•APIæ£€æŸ¥æ–‡ä»¶æ—¶æ·»åŠ æ‰©å±•å

## æ€»ç»“

ç°åœ¨ä¸‰ä¸ªåœ°æ–¹çš„æ–‡ä»¶åç”Ÿæˆé€»è¾‘å®Œå…¨ä¸€è‡´ï¼š
- âœ… é˜Ÿåˆ—ç®¡ç†å™¨ç”Ÿæˆæ–‡ä»¶
- âœ… å†å²è®°å½•åˆ—è¡¨APIæ£€æŸ¥æ–‡ä»¶
- âœ… å†å²è®°å½•è¯¦æƒ…APIæ£€æŸ¥æ–‡ä»¶

æ‰€æœ‰é€»è¾‘éƒ½ä¼šè‡ªåŠ¨ä¸ºæ²¡æœ‰æ‰©å±•åçš„æ–‡ä»¶åæ·»åŠ  `.xlsx` æ‰©å±•åï¼ğŸ‰
