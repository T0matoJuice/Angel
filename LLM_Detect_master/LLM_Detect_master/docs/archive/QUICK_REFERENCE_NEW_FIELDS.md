# 质量工单检测新字段结构快速参考

## 📊 新字段结构（9个字段）

```
工单单号, 故障部位名称, 故障组, 故障类别, 故障件简称, 来电内容, 现场诊断故障现象, 处理方案简述或备注, 工单性质
```

---

## 📋 字段说明

| 序号 | 字段名 | 说明 | 示例 |
|-----|--------|------|------|
| 1 | 工单单号 | 工单的唯一编号 | WO0005059666 |
| 2 | 故障部位名称 | 详细的故障部位描述 | 电源适配器 J1205-ROB8C,CCC，109*51*31mm |
| 3 | 故障组 | 故障所属的产品组别 | 中央净水机/软水机 |
| 4 | 故障类别 | 故障的类型分类 | 结构/水路故障 |
| 5 | 故障件简称 | 故障件的简短名称 | 布水器组件 |
| 6 | 来电内容 | 客户来电描述的问题 | 软水机有胶状的东西流出 |
| 7 | 现场诊断故障现象 | 现场技术人员诊断的故障现象 | 出水嘴故障 |
| 8 | 处理方案简述或备注 | 维修处理方案的简要说明 | 布水器坏，漏树脂，更换 |
| 9 | 工单性质 | AI判断的工单性质（质量工单/非质量工单） | 质量工单 |

---

## 📝 Excel数据格式要求

### 训练数据格式（用于学习）

**必需包含所有9个字段，且"工单性质"列必须有标注：**

| 工单单号 | 故障部位名称 | 故障组 | 故障类别 | 故障件简称 | 来电内容 | 现场诊断故障现象 | 处理方案简述或备注 | 工单性质 |
|---------|------------|--------|---------|-----------|---------|----------------|------------------|---------|
| WO0005059666 | 电源适配器 J1205-ROB8C | 中央净水机/软水机 | 结构/水路故障 | 布水器组件 | 软水机有胶状的东西流出 | 出水嘴故障 | 布水器坏，漏树脂，更换 | **质量工单** |
| WO0005125401 | 布水器组件 S2660-Y09 | 净水机 | 电气故障 | 电源适配器 | 电源线坏了不通电 | 有异响 | 上门调试 | **质量工单** |
| WO0005262538 | 前面板 Y2716BK-K-G | 饮水机 | 电气类 | 前面板 | 客户留言面板碎了 | 更换顶更换顶盖 | 换变压器 | **非质量工单** |

### 测试数据格式（用于推理）

**可以不包含"工单性质"列，由AI自动填充：**

| 工单单号 | 故障部位名称 | 故障组 | 故障类别 | 故障件简称 | 来电内容 | 现场诊断故障现象 | 处理方案简述或备注 | 工单性质 |
|---------|------------|--------|---------|-----------|---------|----------------|------------------|---------|
| WO0005059667 | 滤芯组件 | 净水机 | 水路故障 | 滤芯 | 出水有异味 | 滤芯老化 | 更换滤芯 | *（待AI填充）* |

---

## 🔄 与旧字段的对应关系

| 旧字段名（5个字段） | 新字段名（9个字段） | 变化说明 |
|------------------|------------------|---------|
| 维修工单号 | 工单单号 | 字段重命名 |
| 问题描述 | 来电内容 | 字段重命名 |
| - | **故障部位名称** | **新增字段** |
| - | **故障组** | **新增字段** |
| - | **故障类别** | **新增字段** |
| 故障件 | 故障件简称 | 字段重命名 |
| - | **现场诊断故障现象** | **新增字段** |
| 解决方案 | 处理方案简述或备注 | 字段重命名 |
| 是否质量工单 | 工单性质 | 字段重命名 |

---

## 🎯 判断规则

### 质量工单
涉及产品本身的问题：
- ✅ 产品缺陷（设计缺陷、制造缺陷）
- ✅ 制程问题（生产过程中的质量问题）
- ✅ 研发问题（产品设计不合理）
- ✅ 来料问题（零部件质量问题）

**示例：**
- 电源适配器烧坏 → 质量工单
- 滤芯漏水（密封不良） → 质量工单
- 线束接触不良 → 质量工单

### 非质量工单
涉及外部因素的问题：
- ❌ 安装服务问题（安装不当、调试问题）
- ❌ 环境与使用问题（水质、电压、温度等）
- ❌ 用户操作不当（误操作、维护不当）

**示例：**
- 安装位置不当导致漏水 → 非质量工单
- 用户未按时更换滤芯 → 非质量工单
- 电压不稳导致故障 → 非质量工单

---

## 🚀 使用流程

### 1. 准备训练数据
```
1. 创建Excel文件，包含9个字段
2. 填写历史工单数据
3. 在"工单性质"列标注"质量工单"或"非质量工单"
4. 保存为 training_data.xlsx
```

### 2. 准备测试数据
```
1. 创建Excel文件，包含前8个字段
2. 填写待判断的工单数据
3. "工单性质"列可以留空或不包含此列
4. 保存为 test_data.xlsx
```

### 3. 执行检测
```
1. 启动应用：python LLM_Detection_System/app.py
2. 访问：http://localhost:5000/excel
3. 选择"质量工单智能判定"
4. 上传训练数据（training_data.xlsx）
5. 上传测试数据（test_data.xlsx）
6. 点击"开始检测"
7. 查看结果并下载
```

---

## 📥 下载模板

### CSV格式模板

**训练数据模板：**
```csv
工单单号,故障部位名称,故障组,故障类别,故障件简称,来电内容,现场诊断故障现象,处理方案简述或备注,工单性质
WO0005059666,电源适配器 J1205-ROB8C,中央净水机/软水机,结构/水路故障,布水器组件,软水机有胶状的东西流出,出水嘴故障,布水器坏漏树脂更换,质量工单
WO0005125401,布水器组件 S2660-Y09,净水机,电气故障,电源适配器,电源线坏了不通电,有异响,上门调试,质量工单
WO0005262538,前面板 Y2716BK-K-G,饮水机,电气类,前面板,客户留言面板碎了,更换顶更换顶盖,换变压器,非质量工单
```

**测试数据模板：**
```csv
工单单号,故障部位名称,故障组,故障类别,故障件简称,来电内容,现场诊断故障现象,处理方案简述或备注
WO0005059667,滤芯组件,净水机,水路故障,滤芯,出水有异味,滤芯老化,更换滤芯
WO0005059668,电源线,饮水机,电气故障,电源线,不通电,电源线断裂,更换电源线
```

---

## ⚠️ 常见问题

### Q1: 上传的Excel文件字段不匹配怎么办？
**A:** 系统会自动处理以下情况：
- 如果包含"维修工单号"字段，会自动转换为"工单单号"
- 如果缺少"工单单号"字段，会自动生成序号
- 如果缺少"工单性质"字段，会自动添加空列

### Q2: 训练数据需要多少条记录？
**A:** 建议至少50-100条已标注的记录，数据越多，AI判断越准确。

### Q3: 测试数据可以包含"工单性质"列吗？
**A:** 可以，但会被AI重新判断并覆盖。

### Q4: 字段顺序必须一致吗？
**A:** 不需要，系统会根据字段名称自动识别，但建议保持一致以便阅读。

### Q5: 可以使用旧格式的数据吗？
**A:** 不建议。旧格式（5个字段）缺少关键信息，会影响AI判断准确率。

---

## 🔧 技术细节

### 后端处理流程
```
1. 读取Excel文件
2. 标准化列名（维修工单号 → 工单单号）
3. 添加缺失的"工单性质"列
4. 转换为CSV文本格式
5. 调用AI模型进行两阶段推理
6. 返回包含9个字段的结果
```

### 前端显示逻辑
```
1. 接收后端返回的JSON数据
2. 提取columns数组（字段名列表）
3. 动态生成表格表头
4. 遍历data数组填充单元格
5. 支持下载为CSV/Excel格式
```

---

## 📞 技术支持

如有问题，请参考：
- 详细更新文档：`FIELD_STRUCTURE_UPDATE_SUMMARY.md`
- 测试脚本：`test_field_structure.py`
- API迁移文档：`API_MIGRATION_SUMMARY.md`

---

**更新日期**：2025-11-06  
**版本**：v2.0 - 新字段结构

