#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Excel工单检测工具函数模块 - 代码
"""

import pandas as pd

def allowed_excel_file(filename):
    """检查文件是否为Excel格式 - 逻辑"""
    return filename.lower().endswith(('.xlsx', '.xls'))

def validate_excel_file(filepath):
    """验证Excel文件格式并返回基本信息"""
    try:
        df = pd.read_excel(filepath, dtype=str)
        rows, cols = df.shape
        return True, rows, cols, None
    except Exception as e:
        return False, 0, 0, str(e)

def create_template_data(template_type):
    """创建Excel模板数据

    根据模板类型生成标准的Excel模板数据，用于用户下载和参考

    Args:
        template_type (str): 模板类型 ('detection' 或 'quality')

    Returns:
        dict: 包含标准列名和示例数据的字典
    """
    if template_type == 'detection':
        # 工单问题点检测模板 - 包含标准列名和示例数据
        return {
            '编号(维修行)': ['RL0011191618', 'RL0011191619', 'RL0011191620'],
            '来电内容(维修行)': ['净水器不出水', '水质TDS值偏高', '机器漏水'],
            '现场诊断故障现象(维修行)': ['现场检测发现增压泵不工作', '检测RO滤芯已堵塞', '发现水路接头松动'],
            '故障部位(维修行)': ['增压泵', '滤芯', '水路接头'],
            '故障件名称(维修行)': ['增压泵', 'RO滤芯', '水路接头'],
            '处理方案简述(维修行)': ['更换增压泵', '更换RO滤芯', '紧固水路接头'],
            '故障类别(维修行)': ['电气类', '滤芯类', '水路类'],
            '维修问题点': ['', '', ''],  # AI自动填充字段
            '二级问题点': ['', '', '']   # AI自动填充字段
        }
    elif template_type == 'quality':
        # 质量工单判断检测模板 - 基于训练数据新100条.xlsx的11列结构
        return {
            '工单单号': ['WO0018061999', 'WO0018091779', 'WO0018103417'],
            '判定依据': ['声音大，现场检测正常', '滤芯堵塞不出水', '异响，增加减压阀'],
            '故障部位名称': ['', '', ''],  # 可选字段
            '故障组': ['净水机', '净水机', '净水机'],
            '故障类别': ['产品鉴定', '产品鉴定', '安全维护'],
            '服务项目或故障现象': ['线上销售的产品质量鉴定', '线上销售的产品质量鉴定', '加装减压阀'],
            '故障件简称': ['', '', ''],  # 可选字段
            '来电内容': ['E8故障    请先电话联系客户', '2个月内出现4.5次不出水   前一天师傅检查正常另一天又不出水', '经销商代报维修 上门检修'],
            '现场诊断故障现象': ['出水龙头显示E8故障码，不显示TDS值', '安排专业师傅', '有异响'],
            '处理方案简述或备注': ['用户不考虑维修，申请退换机', '滤芯堵了不出水           要求换机', '师傅已上门处理，增加减压阀'],
            '工单性质': ['', '', '']  # 待AI填充
        }
    else:
        return None
