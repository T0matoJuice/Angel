<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AIæ£€æµ‹é—®é¢˜æ±‡æ€»</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --grad-left: #667eea;
            --grad-right: #764ba2;
            --card-bg: #fff;
            --radius: 12px;
            --shadow: 0 8px 32px rgba(0, 0, 0, .1);
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, var(--grad-left) 0%, var(--grad-right) 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        /* é¡¶éƒ¨æ“ä½œåŒº */
        .header {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px 30px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 15px;
        }
        .header .title {
            font-size: 24px;
            color: #333;
            margin-right: auto;
        }
        .btn {
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: .3s;
        }
        .btn-primary {
            background: linear-gradient(45deg, var(--grad-left), var(--grad-right));
            color: #fff;
        }
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, .15);
        }
        .date-range {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .date-range input {
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
        }
        select, input[type="text"] {
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
        }

        /* å›¾è¡¨åŒº */
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .chart-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .chart-title {
            font-size: 18px;
            color: #333;
        }
        #chartContainer {
            height: 400px;
            position: relative;
        }

        /* å·¦ä¾§ç»Ÿè®¡è¡¨æ ¼ */
        .stat-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .stat-table th, .stat-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
            text-align: left;
        }
        .stat-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        /* é—®é¢˜æ˜ç»†åˆ—è¡¨ */
        .table-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
        }
        .table-card .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
            text-align: left;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        tr:hover {
            background: #f8f9ff;
        }
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-å°ºå¯¸é”™è¯¯ {
            background: #ffe1e1;
            color: #d80000;
        }
        .badge-ç‰ˆæœ¬é”™è¯¯ {
            background: #fff3cd;
            color: #856404;
        }
        .badge-å›¾æ¡†é”™è¯¯ {
            background: #d1ecf1;
            color: #0c5460;
        }
        .badge-ç¼ºå°‘å•ä¸€æè´¨é‡é‡ {
            background: #d4edda;
            color: #155724;
        }
        .badge-ç¼ºå°‘é‡ç‚¹å°ºå¯¸ {
            background: #f8d7da;
            color: #721c24;
        }
        .badge-ç¼ºå°‘æœªæ³¨å…¬å·® {
            background: #e2e3e5;
            color: #383d41;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: stretch;
            }
            .chart-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <base target="_blank">
</head>
<body>
<div class="container">
    <!-- é¡¶éƒ¨æ“ä½œåŒº -->
    <div class="header">
        <div class="title">AIæ£€æµ‹é—®é¢˜æ±‡æ€»</div>

        <div class="date-range">
            <span>æ—¥æœŸèŒƒå›´ï¼š</span>
            <input type="date" id="startDate" value="2025-06-01">
            <span>-</span>
            <input type="date" id="endDate" value="2025-10-31">
        </div>

        <select id="creatorFilter">
            <option value="">åˆ›å»ºäººç­›é€‰</option>
            <option value="å¼ ä¸‰">å¼ ä¸‰</option>
            <option value="æå››">æå››</option>
            <option value="ç‹äº”">ç‹äº”</option>
        </select>

        <select id="materialFilter">
            <option value="">ç‰©æ–™ç­›é€‰</option>
            <option value="å¡‘èƒ¶ä»¶">å¡‘èƒ¶ä»¶</option>
            <option value="é’£é‡‘ä»¶">é’£é‡‘ä»¶</option>
            <option value="æœºåŠ ä»¶">æœºåŠ ä»¶</option>
        </select>

        <button class="btn btn-primary" onclick="handleQuery()">ğŸ” æŸ¥è¯¢</button>
        <button class="btn btn-secondary" onclick="handleReset()">é‡ç½®</button>
        <a class="btn btn-primary" href="#" download="ai_issue.csv">ğŸ“¥ ä¸‹è½½</a>
    </div>

    <!-- å›¾è¡¨åŒº -->
    <div class="chart-row">
        <!-- å·¦ä¾§ç»Ÿè®¡è¡¨æ ¼ -->
        <div class="chart-card">
            <div class="chart-header">
                <span class="chart-title">ç»Ÿè®¡ä¿¡æ¯</span>
            </div>
            <table class="stat-table">
                <tr>
                    <th>æ—¥æœŸèŒƒå›´</th>
                    <td id="dateRangeText">2025-06 è‡³ 2025-10</td>
                </tr>
                <tr>
                    <th>æ£€æµ‹å›¾çº¸æ€»æ•°</th>
                    <td>1000</td>
                </tr>
                <tr>
                    <th>é—®é¢˜æ€»æ•°</th>
                    <td>400</td>
                </tr>
                <tr>
                    <th>é—®é¢˜ç±»å‹</th>
                    <th>é—®é¢˜æ•°é‡</th>
                </tr>
                <tr>
                    <td>å°ºå¯¸é”™è¯¯</td>
                    <td>50</td>
                </tr>
                <tr>
                    <td>ç‰ˆæœ¬é”™è¯¯</td>
                    <td>50</td>
                </tr>
                <tr>
                    <td>å›¾æ¡†é”™è¯¯</td>
                    <td>50</td>
                </tr>
                <tr>
                    <td>ç¼ºå°‘å•ä¸€æè´¨é‡é‡</td>
                    <td>50</td>
                </tr>
                <tr>
                    <td>ç¼ºå°‘é‡ç‚¹å°ºå¯¸</td>
                    <td>100</td>
                </tr>
                <tr>
                    <td>ç¼ºå°‘æœªæ³¨å…¬å·®</td>
                    <td>100</td>
                </tr>
            </table>
        </div>

        <!-- å³ä¾§é—®é¢˜ç±»å‹åˆ†å¸ƒå›¾è¡¨ -->
        <!-- æ›¿æ¢åŸâ€œå³ä¾§é—®é¢˜ç±»å‹åˆ†å¸ƒå›¾è¡¨â€æ•´ä¸ª div -->
        <div class="chart-card">
            <div class="chart-header">
                <span class="chart-title" id="chartTitle">é—®é¢˜ç±»å‹åˆ†å¸ƒ</span>
                <button class="btn btn-secondary" id="toggleBtn" onclick="toggleChart()">åˆ‡æ¢ä¸ºç¬¦åˆç‡</button>
            </div>
            <div id="chartContainer">
                <canvas id="barChart"></canvas>
            </div>
        </div>
    </div>

    <!-- é—®é¢˜æ˜ç»†åˆ—è¡¨ -->
    <div class="table-card">
        <div class="section-title">
            ğŸ“‹ é—®é¢˜æ˜ç»†åˆ—è¡¨
            <div>
                <label for="issueTypeFilter">é—®é¢˜ç±»å‹ç­›é€‰ï¼š</label>
                <select id="issueTypeFilter" onchange="filterTable()">
                    <option value="">å…¨éƒ¨</option>
                    <option value="å°ºå¯¸é”™è¯¯">å°ºå¯¸é”™è¯¯</option>
                    <option value="ç‰ˆæœ¬é”™è¯¯">ç‰ˆæœ¬é”™è¯¯</option>
                    <option value="å›¾æ¡†é”™è¯¯">å›¾æ¡†é”™è¯¯</option>
                    <option value="ç¼ºå°‘å•ä¸€æè´¨é‡é‡">ç¼ºå°‘å•ä¸€æè´¨é‡é‡</option>
                    <option value="ç¼ºå°‘é‡ç‚¹å°ºå¯¸">ç¼ºå°‘é‡ç‚¹å°ºå¯¸</option>
                    <option value="ç¼ºå°‘æœªæ³¨å…¬å·®">ç¼ºå°‘æœªæ³¨å…¬å·®</option>
                </select>
            </div>
        </div>
        <table id="detailTable">
            <thead>
            <tr>
                <th>åºå·</th>
                <th>æ£€æŸ¥æ—¥æœŸ</th>
                <th>é—®é¢˜ç±»å‹</th>
                <th>å·¥ç¨‹å¸ˆ</th>
                <th>ç‰©æ–™åç§°</th>
                <th>ç‰©æ–™åˆ†ç±»</th>
                <th>å›¾å·</th>
            </tr>
            </thead>
            <tbody id="detailBody">
            <!-- é™æ€ç¤ºä¾‹æ•°æ® -->
            <tr data-type="å°ºå¯¸é”™è¯¯">
                <td>1</td>
                <td>2025-10-30</td>
                <td><span class="badge badge-å°ºå¯¸é”™è¯¯">å°ºå¯¸é”™è¯¯</span></td>
                <td>å¼ ä¸‰</td>
                <td>æ˜¾ç¤ºé¢æ¿</td>
                <td>å¡‘èƒ¶ä»¶</td>
                <td>J3506-ROC90-01</td>
            </tr>
            <tr data-type="ç‰ˆæœ¬é”™è¯¯">
                <td>2</td>
                <td>2025-10-30</td>
                <td><span class="badge badge-ç‰ˆæœ¬é”™è¯¯">ç‰ˆæœ¬é”™è¯¯</span></td>
                <td>å¼ ä¸‰</td>
                <td>æ˜¾ç¤ºé¢æ¿</td>
                <td>å¡‘èƒ¶ä»¶</td>
                <td>J3506-ROC90-01</td>
            </tr>
            <tr data-type="å›¾æ¡†é”™è¯¯">
                <td>3</td>
                <td>2025-10-29</td>
                <td><span class="badge badge-å›¾æ¡†é”™è¯¯">å›¾æ¡†é”™è¯¯</span></td>
                <td>æå››</td>
                <td>æ”¯æ¶</td>
                <td>é’£é‡‘ä»¶</td>
                <td>J3506-BK150-03</td>
            </tr>
            <tr data-type="ç¼ºå°‘å•ä¸€æè´¨é‡é‡">
                <td>4</td>
                <td>2025-10-28</td>
                <td><span class="badge badge-ç¼ºå°‘å•ä¸€æè´¨é‡é‡">ç¼ºå°‘å•ä¸€æè´¨é‡é‡</span></td>
                <td>ç‹äº”</td>
                <td>å£³ä½“</td>
                <td>æœºåŠ ä»¶</td>
                <td>J3506-CS200-05</td>
            </tr>
            <tr data-type="ç¼ºå°‘é‡ç‚¹å°ºå¯¸">
                <td>5</td>
                <td>2025-10-27</td>
                <td><span class="badge badge-ç¼ºå°‘é‡ç‚¹å°ºå¯¸">ç¼ºå°‘é‡ç‚¹å°ºå¯¸</span></td>
                <td>èµµå…­</td>
                <td>åº•åº§</td>
                <td>å¡‘èƒ¶ä»¶</td>
                <td>J3506-DB120-02</td>
            </tr>
            <tr data-type="ç¼ºå°‘æœªæ³¨å…¬å·®">
                <td>6</td>
                <td>2025-10-26</td>
                <td><span class="badge badge-ç¼ºå°‘æœªæ³¨å…¬å·®">ç¼ºå°‘æœªæ³¨å…¬å·®</span></td>
                <td>é’±ä¸ƒ</td>
                <td>ç›–æ¿</td>
                <td>é’£é‡‘ä»¶</td>
                <td>J3506-GB080-04</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- å¼•å…¥ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- æŒ‰é’®å·²åŠ å¥½ï¼Œæ— éœ€åŠ¨ HTMLï¼ŒåªæŠŠ JS å°¾éƒ¨æ”¹æˆä¸‹é¢è¿™æ · -->
<script>
    /* 1. ç»Ÿä¸€å…¨å±€å˜é‡åï¼Œä¸è¦é‡å¤å£°æ˜ */
    let chart;   // â† å»æ‰å‰é¢çš„ let chart = new Chart(...) é‡Œçš„ let

    /* 2. ç”Ÿæˆæœˆä»½æ ‡ç­¾å’Œé™æ€æ•°æ®ï¼ˆä½ åŸæ¥å°±æœ‰ï¼Œä¿ç•™ï¼‰ */
    function generateMonthLabels(start, end) {
        const labels = [];
        const startMonth = new Date(start + '-01');
        const endMonth = new Date(end + '-01');
        while (startMonth <= endMonth) {
            labels.push(startMonth.toISOString().slice(0, 7));
            startMonth.setMonth(startMonth.getMonth() + 1);
        }
        return labels;
    }
    const issueTypes = [
        {name: 'å°ºå¯¸é”™è¯¯', color: '#ff6384'},
        {name: 'ç‰ˆæœ¬é”™è¯¯', color: '#36a2eb'},
        {name: 'å›¾æ¡†é”™è¯¯', color: '#ffce56'},
        {name: 'ç¼ºå°‘å•ä¸€æè´¨é‡é‡', color: '#4bc0c0'},
        {name: 'ç¼ºå°‘é‡ç‚¹å°ºå¯¸', color: '#9966ff'},
        {name: 'ç¼ºå°‘æœªæ³¨å…¬å·®', color: '#ff9f40'}
    ];
    const staticData = {
        '2025-06': [8, 7, 6, 5, 15, 14],
        '2025-07': [10, 9, 8, 7, 18, 17],
        '2025-08': [9, 8, 7, 6, 16, 15],
        '2025-09': [12, 11, 10, 9, 22, 21],
        '2025-10': [11, 10, 9, 8, 19, 18]
    };

    /* 3. é¦–æ¬¡åŠ è½½ï¼šç”»æŸ±çŠ¶å›¾ */
    window.onload = () => {
        const labels = generateMonthLabels('2025-06','2025-10');
        const datasets = issueTypes.map((t,i)=>({
            label: t.name,
            data: labels.map(m=>staticData[m][i]),
            backgroundColor: t.color
        }));
        const cfg = {
            type:'bar',
            data:{labels,datasets},
            options:{
                responsive:true,
                maintainAspectRatio:false,
                plugins:{legend:{position:'bottom'}},
                scales:{
                    x:{title:{display:true,text:'æœˆä»½'}},
                    y:{title:{display:true,text:'é—®é¢˜æ•°é‡'},beginAtZero:true}
                }
            }
        };
        const ctx = document.getElementById('barChart').getContext('2d');
        chart = new Chart(ctx, cfg);   // â† ç›´æ¥èµ‹å€¼ç»™å…¨å±€å˜é‡
    };

    /* 4. é¥¼å›¾é…ç½® */
    function buildPieCfg(){
        const total = 1000, problem = 400, compliant = total - problem;
        return {
            type:'pie',
            data:{
                labels:['ç¬¦åˆ','ä¸ç¬¦åˆ'],
                datasets:[{
                    data:[compliant, problem],
                    backgroundColor:['#4bc0c0','#ff6384'],
                    borderWidth:2,
                    borderColor:'#fff'
                }]
            },
            options:{
                responsive:true,
                maintainAspectRatio:false,
                plugins:{
                    legend:{position:'bottom'},
                    tooltip:{
                        callbacks:{
                            label:function(ctx){
                                const v = ctx.parsed;
                                const p = Math.round(v/1000*100);
                                return ctx.label + 'ï¼š' + v + ' (' + p + '%)';
                            }
                        }
                    }
                }
            }
        };
    }

    /* 5. åˆ‡æ¢å‡½æ•° */
    function toggleChart(){
        const btn   = document.getElementById('toggleBtn');
        const title = document.getElementById('chartTitle');
        const ctx   = document.getElementById('barChart').getContext('2d');

        chart.destroy();          // â† å…ˆé”€æ¯å½“å‰å®ä¾‹
        if(chart.config.type==='bar'){
            chart = new Chart(ctx, buildPieCfg());
            btn.textContent  = 'åˆ‡æ¢ä¸ºæŸ±çŠ¶å›¾';
            title.textContent= 'ç¬¦åˆç‡å æ¯”';
        }else{
            const labels = generateMonthLabels('2025-06','2025-10');
            const datasets = issueTypes.map((t,i)=>({
                label: t.name,
                data: labels.map(m=>staticData[m][i]),
                backgroundColor: t.color
            }));
            chart = new Chart(ctx, {
                type:'bar',
                data:{labels,datasets},
                options:{
                    responsive:true,
                    maintainAspectRatio:false,
                    plugins:{legend:{position:'bottom'}},
                    scales:{
                        x:{title:{display:true,text:'æœˆä»½'}},
                        y:{title:{display:true,text:'é—®é¢˜æ•°é‡'},beginAtZero:true}
                    }
                }
            });
            btn.textContent  = 'åˆ‡æ¢ä¸ºç¬¦åˆç‡';
            title.textContent= 'é—®é¢˜ç±»å‹åˆ†å¸ƒ';
        }
    }
</script>
</body>
</html>