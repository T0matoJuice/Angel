# 统计报表使用说明

## 概述

系统新增了两个统计报表页面,用于展示AI检测的统计数据:

1. **制图检测统计报表** - 展示AI检测问题汇总
2. **质量工单判定准确率统计报表** - 展示AI判定准确率统计

## 访问路径

### 1. 制图检测统计报表

**页面路径**: `/drawing/charts`

**完整URL**: `http://localhost:5000/drawing/charts`

**功能说明**:
- 显示制图检测的问题类型分布统计
- 支持日期范围筛选
- 支持创建人筛选
- 支持物料类型筛选
- 提供问题类型柱状图和符合率饼图切换
- 展示问题明细列表,支持按问题类型筛选

**数据来源**: 
- 从 `drawing_data` 和 `drawing_dataset` 表读取实时数据
- API接口: `GET /drawing/api/charts/statistics`

**筛选参数**:
- `start_date`: 开始日期 (YYYY-MM-DD)
- `end_date`: 结束日期 (YYYY-MM-DD)
- `creator`: 创建人
- `material_type`: 物料类型

### 2. 质量工单判定准确率统计报表

**页面路径**: `/excel/charts`

**完整URL**: `http://localhost:5000/excel/charts`

**功能说明**:
- 显示质量工单AI判定的准确率统计
- 支持日期范围筛选
- 支持创建人筛选
- 提供判定准确率趋势图
- 展示历史工单判定列表

**数据来源**:
- 从 `workorder_data` 表读取实时数据
- API接口: `GET /excel/api/charts/statistics`

**筛选参数**:
- `start_date`: 开始日期 (YYYY-MM-DD)
- `end_date`: 结束日期 (YYYY-MM-DD)
- `creator`: 创建人

## 使用步骤

### 启动系统

1. 确保数据库已启动并配置正确
2. 启动Flask应用:
   ```bash
   cd LLM_Detection_System
   python app.py
   ```
3. 访问系统: `http://localhost:5000`

### 访问统计报表

#### 方式一: 直接访问URL

- 制图检测统计: `http://localhost:5000/drawing/charts`
- 质量工单统计: `http://localhost:5000/excel/charts`

#### 方式二: 通过导航菜单 (需要在主页添加入口)

建议在主页或相应模块页面添加统计报表的入口链接。

### 使用筛选功能

1. **日期范围筛选**:
   - 选择开始日期和结束日期
   - 点击"查询"按钮

2. **创建人筛选**:
   - 从下拉列表选择创建人
   - 点击"查询"按钮

3. **物料类型筛选** (仅制图检测):
   - 从下拉列表选择物料类型
   - 点击"查询"按钮

4. **重置筛选**:
   - 点击"重置"按钮恢复默认筛选条件

### 图表交互

#### 制图检测统计报表

- **切换图表类型**: 点击"切换为符合率"/"切换为柱状图"按钮
  - 柱状图: 显示各问题类型的月度分布
  - 饼图: 显示符合/不符合的占比

- **问题明细筛选**: 使用"问题类型筛选"下拉框过滤明细列表

#### 质量工单判定准确率统计报表

- **准确率趋势图**: 显示各月份的判定准确率变化趋势

## API接口说明

### 制图检测统计API

**接口**: `GET /drawing/api/charts/statistics`

**请求参数**:
```
start_date: 2025-06-01
end_date: 2025-10-31
creator: 张三 (可选)
material_type: 塑胶件 (可选)
```

**响应示例**:
```json
{
  "success": true,
  "statistics": {
    "date_range": "2025-06 至 2025-10",
    "total_drawings": 1000,
    "total_issues": 400,
    "issue_types": {
      "尺寸错误": 50,
      "版本错误": 50,
      "图框错误": 50,
      "缺少单一材质重量": 50,
      "缺少重点尺寸": 100,
      "缺少未注公差": 100
    },
    "monthly_data": {
      "2025-06": {"尺寸错误": 8, "版本错误": 7, ...},
      ...
    }
  },
  "details": [
    {
      "check_date": "2025-10-30",
      "issue_type": "尺寸错误",
      "engineer": "张三",
      "material_name": "显示面板",
      "material_type": "塑胶件",
      "drawing_id": "J3506-ROC90-01"
    },
    ...
  ]
}
```

### 质量工单判定统计API

**接口**: `GET /excel/api/charts/statistics`

**请求参数**:
```
start_date: 2025-06-01
end_date: 2025-10-31
creator: 张三 (可选)
```

**响应示例**:
```json
{
  "success": true,
  "statistics": {
    "date_range": "2025-06 至 2025-10",
    "total_workorders": 1000,
    "quality_issues": 400,
    "non_quality_issues": 600,
    "accuracy_rate": 96.0,
    "monthly_accuracy": {
      "2025-06": 94.2,
      "2025-07": 95.8,
      ...
    }
  },
  "history": [
    {
      "work_alone": "WO-202510-0001",
      "work_order_nature": "质量问题",
      "creator": "张三",
      "created_time": "2025-10-30 14:32:18",
      "judgment_basis": "尺寸超差，不符合图纸要求"
    },
    ...
  ]
}
```

## 注意事项

1. **数据权限**: 需要登录后才能访问统计报表页面
2. **数据来源**: 统计数据来自数据库实时查询,确保数据库中有足够的检测记录
3. **性能考虑**: 大数据量查询可能需要较长时间,建议合理设置日期范围
4. **准确率计算**: 质量工单的准确率目前使用模拟数据,实际应该根据人工复核结果计算

## 后续优化建议

1. 在主页或模块页面添加统计报表入口链接
2. 添加数据导出功能(CSV/Excel)
3. 添加更多统计维度(按部门、按产品类型等)
4. 优化大数据量查询性能
5. 添加数据缓存机制
6. 实现准确率的真实计算逻辑(需要人工复核数据)
